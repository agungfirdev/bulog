<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Banpang 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .root {
        height: 100vh;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <!-- add react -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- add tailwind 3 -->

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <script type="text/babel">
      const Button = ({
        onClick,
        children,
        variant = "primary",
        disabled = false,
        onFocus = () => {},
      }) => {
        // variant can be "primary", "secondary", "danger"
        const buttonStyles = {
          primary: "bg-blue-500 text-white hover:bg-blue-600",
          secondary: "bg-gray-500 text-white hover:bg-gray-600",
          danger: "bg-red-500 text-white hover:bg-red-600",
          success: "bg-green-500 text-white hover:bg-green-600",
        };

        return (
          <button
            onClick={onClick}
            onFocus={onFocus}
            className={`mx-1 px-4 py-2 rounded-xl ${buttonStyles[variant]} disabled:opacity-50 disabled:cursor-not-allowed transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`}
            disabled={disabled}
          >
            {children}
          </button>
        );
      };

      const App = () => {
        return <Recipients />;
      };

      const Recipients = () => {
        const [recipients, setRecipients] = React.useState([]);
        const [recipientSelected, setRecipientSelected] = React.useState(null);
        const [rotation, setRotation] = React.useState(0);

        React.useEffect(() => {
          // fetching /recipients
          fetch("/recipients/:id")
            .then((response) => response.json())
            .then((data) => {
              setRecipients(data);
            })
            .catch((error) => {
              console.error("Error fetching recipients:", error);
            });
        }, []);

        const verifyRecipient = (recipient) => {
          // fetching post /recipients/verify
          fetch(`/recipients/verify`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ pbp_id: recipient.id }),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              // Update the state to remove the verified recipient
              setRecipients((prevRecipients) =>
                prevRecipients.filter((r) => r.id !== recipient.id)
              );
              console.log("Recipient verified:", data);
            })
            .catch((error) => {
              console.error("Error verifying recipient:", error);
            });
        };

        const rotateImage = (event) => {
          setRotation((prev) => (prev >= 270 ? 0 : prev + 90));
        };
        const onMouseOver = (event) => {
          const img = event.currentTarget;
          img.style.transition = "transform 0.3s";
          img.style.transform = "scale(2)";
        };

        const onMouseOut = (event) => {
          const img = event.currentTarget;
          img.style.transform = "scale(1.25)";
          img.style.transformOrigin = "center center";
        };

        const onMouseMove = (event) => {
          const img = event.currentTarget;
          const rect = img.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          const percentX = (x / rect.width) * 100;
          const percentY = (y / rect.height) * 100;
          img.style.transformOrigin = `${percentX}% ${percentY}%`;
        };

        return (
          <div className="h-screen">
            {recipientSelected === null && (
              <img
                src="https://banpang.bulog.co.id/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fbg.7029ac3e.jpg&w=3840&q=75"
                className="absolute top-0 left-0 w-full h-full object-cover opacity-50"
              />
            )}
            <div className="md:grid grid-cols-2 relative">
              <div className="col-span-1 relative">
                <div className="w-full h-[50vh] md:h-screen sticky top-0 overflow-hidden">
                  {recipientSelected && (
                    <img
                      src={
                        recipientSelected && recipientSelected
                          ? `/${recipientSelected.nama_kabkota}/${recipientSelected.nama_kecamatan}/${recipientSelected.nama_kelurahan}/${recipientSelected.no_pbp}_KTP.jpg`
                          : "https://via.placeholder.com/150"
                      }
                      alt="Foto PBP"
                      className={`"w-full h-screen object-cover scale-125 transition ease-in-out duration-300 ${
                        rotation ? `rotate-${rotation}` : ""
                      }`}
                      onMouseOver={onMouseOver}
                      onMouseOut={onMouseOut}
                      onMouseMove={onMouseMove}
                      onClick={rotateImage}
                    />
                  )}
                </div>
              </div>
              <div className="col-span-1 relative">
                <div className="w-full h-[50vh] md:h-screen sticky top-0 overflow-hidden">
                  {recipientSelected && (
                    <img
                      src={
                        recipientSelected && recipientSelected
                          ? `/${recipientSelected.nama_kabkota}/${recipientSelected.nama_kecamatan}/${recipientSelected.nama_kelurahan}/${recipientSelected.no_pbp}_PBP.jpg`
                          : "https://via.placeholder.com/150"
                      }
                      alt="Foto PBP"
                      className="w-full h-screen object-cover"
                    />
                  )}
                </div>
              </div>
            </div>
            <div className="fixed flex items-stretch flex-col md:flex-row bottom-0 left-0 right-0 bg-black/75 p-4 shadow-md h-80 md:h-64 overflow-y-auto overflow-x-hidden">
              <div className="w-1/3 text-white sticky top-0 hidden md:flex">
                {recipientSelected && (
                  // change to table with flex
                  <div className="mt-2 w-full">
                    <div className="flex">
                      <div className="w-32">
                        <strong>Nama</strong>
                      </div>
                      <div className="flex-1 md:text-xl">
                        {recipientSelected.nama}
                      </div>
                    </div>
                    <div className="flex">
                      <div className="w-32">
                        <strong>NIK</strong>
                      </div>
                      <div className="flex-1 md:text-xl">
                        {recipientSelected.nik}
                      </div>
                    </div>
                    <div className="flex">
                      <div className="w-32">
                        <strong>Status</strong>
                      </div>
                      <div className="flex-1 md:text-xl">
                        {recipientSelected.status_pbp.toUpperCase()}
                      </div>
                    </div>
                    <div className="flex">
                      <div className="w-32">
                        <strong>Penerima</strong>
                      </div>
                      <div className="flex-1 md:text-xl">
                        {recipientSelected.nama_pengganti &&
                          recipientSelected.nama_pengganti.toUpperCase()}
                      </div>
                    </div>
                  </div>
                )}
              </div>
              <div className="flex flex-col flex-1">
                {recipients.map((recipient) => (
                  <div
                    key={recipient.id}
                    className={`flex-row md:flex items-center justify-between p-3 border-white hover:text-black hover:bg-white hover:rounded-xl transition-colors duration-200 ${
                      recipientSelected && recipientSelected.id === recipient.id
                        ? "bg-white rounded-xl text-black"
                        : "bg-transparent text-white"
                    }`}
                    onClick={() => setRecipientSelected(recipient)}
                  >
                    <div className="flex-1">{recipient.nama}</div>
                    <div className="flex-1">{recipient.nik}</div>
                    <div className="flex-1">
                      {recipient.status_pbp === "normal" &&
                      recipient.nama_pengganti !== null
                        ? "1KK"
                        : recipient.status_pbp.toUpperCase()}
                    </div>
                    <div className="flex-1">
                      {recipient.status_pbp === "normal" &&
                      recipient.nama_pengganti !== null
                        ? recipient.nama_pengganti.toUpperCase()
                        : recipient.nama_pengganti &&
                          recipient.nama_pengganti.toUpperCase()}
                    </div>
                    <div className="flex-1">
                      {recipient.status_pbp === "normal" &&
                      recipient.nama_pengganti !== null
                        ? recipient.nik_pengganti
                        : recipient.nik_pengganti && recipient.nik_pengganti}
                    </div>
                    <div>
                      <Button
                        onClick={() => verifyRecipient(recipient)}
                        onFocus={() => setRecipientSelected(recipient)}
                        variant="success"
                        disabled={recipient.verified}
                      >
                        Terima
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };
      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
